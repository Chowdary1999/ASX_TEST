<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ASX Swing Trader — Top 3 (AI + Tracking + Fees)</title>
<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#0b1020;color:#e2e8f0}.card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid rgba(148,163,184,.15);border-radius:1rem}.glass{background:rgba(255,255,255,.06);border:1px solid rgba(148,163,184,.18);border-radius:.75rem}.btn{transition:transform .06s ease}.btn:active{transform:translateY(1px)}.muted{color:#94a3b8}.pill{padding:.15rem .5rem;border-radius:.5rem;font-size:.75rem}.row{border-top:1px dashed rgba(148,163,184,.2);padding-top:.5rem;margin-top:.5rem}</style>
</head><body class="min-h-screen"><div id="root"></div>
<script type="text/babel">
const {useState,useEffect} = React;
const API='/.netlify/functions/market', AI='/.netlify/functions/advice';
function feeFor(c){c=Number(c||0);if(c<=1000)return 5;if(c<=3000)return 10;if(c<=10000)return 19.95;if(c<=25000)return 29.95;return 29.95}
function breakdown(capital,entry){const buy=feeFor(capital),sell=feeFor(capital);const qty=Math.max(0,Math.floor(Number(capital)/Number(entry)));const invested=qty*Number(entry)+buy;const total=buy+sell;const be=qty>0?(Number(capital)+total)/qty:null;return{qty,buyFee:buy,sellFee:sell,totalFees:total,invested,breakeven:be}}
function useLocal(k,i){const [v,setV]=useState(()=>{try{const s=localStorage.getItem(k);return s?JSON.parse(s):i}catch{return i}});useEffect(()=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}},[v]);return [v,setV]}
function Header({capital,setCapital}){return(<header className="p-6"><h1 className="text-2xl md:text-3xl font-semibold">ASX Swing Trader <span className="text-violet-400">· top 3 picks</span></h1><div className="text-slate-300 text-sm mt-2 flex flex-wrap gap-3 items-center"><span className="muted">Default capital (AUD):</span><input type="number" min="50" step="1" className="glass px-3 py-2 rounded-md w-40 text-slate-100" value={capital} onChange={e=>setCapital(Math.max(0,Number(e.target.value||0)))} /><span className="muted text-xs">CommSec fees auto-applied</span></div></header>)}
function ErrorLine({msg}){return msg?<p className="text-sm text-rose-400">⚠️ {msg}</p>:null}
function Top3({onPurchase,capital}){const [picks,setPicks]=useState([]);const [err,setErr]=useState(null);const [loading,setLoading]=useState(false);const [ai,setAi]=useState(null);const [aiErr,setAiErr]=useState(null);const [aiLoading,setAiLoading]=useState(false);const [open,setOpen]=useState({});const [amt,setAmt]=useState({});
async function refresh(){setErr(null);setLoading(true);try{const r=await fetch(`${API}?fn=pick3`);const j=await r.json();if(j.error)throw new Error(j.error);setPicks(j.picks||[]);setAi(null);setAiErr(null)}catch(e){setErr(e.message);setPicks([])}finally{setLoading(false)}}
useEffect(()=>{refresh()},[]);useEffect(()=>{const id=setInterval(()=>refresh(),5*60*1000);return()=>clearInterval(id)},[]);
async function askAI(){setAiErr(null);setAi(null);setAiLoading(true);try{const r=await fetch(`${AI}?mode=pick&capital=${encodeURIComponent(capital)}`);const j=await r.json();if(j.error)throw new Error(j.error+(j.details?(' · '+j.details):''));setAi(j.advice)}catch(e){setAiErr(e.message)}finally{setAiLoading(false)}}
function toggle(sym){setOpen(o=>({...o,[sym]:!o[sym]}));setAmt(a=>({...a,[sym]:a[sym]??capital}))}
function confirm(p){const a=Number(amt[p.symbol]);if(!isFinite(a)||a<=0){alert('Enter a valid amount');return}const bd=breakdown(a,p.last);onPurchase({...p,capital:a,qty:bd.qty,buyFee:bd.buyFee,sellFee:bd.sellFee,breakeven:bd.breakeven});setOpen(o=>({...o,[p.symbol]:false}))}
return(<div className="card p-5 md:p-6 space-y-3"><div className="flex items-center justify-between"><h2 className="text-lg font-semibold">Top 3 Daily Picks</h2><div className="flex gap-2"><button className="btn px-3 py-1.5 rounded-lg bg-slate-700 hover:bg-slate-600" onClick={refresh} disabled={loading}>{loading?'Loading…':'Refresh'}</button><button className="btn px-3 py-1.5 rounded-lg bg-sky-600 hover:bg-sky-700" onClick={askAI} disabled={aiLoading}>{aiLoading?'Asking…':'Ask ChatGPT (summary)'}</button></div></div><ErrorLine msg={err}/>{picks.length===0&&!err&&<p className="muted text-sm">Finding candidates…</p>}<div className="space-y-2">{picks.map(p=>{const bd=breakdown(capital,p.last);const isOpen=!!open[p.symbol];const curAmt=amt[p.symbol]??capital;const bd2=breakdown(curAmt,p.last);return(<div key={p.symbol} className="glass p-3 rounded-lg space-y-1"><div className="flex justify-between items-center"><div><span className="font-semibold">#{p.rank} {p.symbol}</span> <span className="text-xs text-slate-400">{p.name||''}</span></div><span className="pill bg-white/10">Score {p.score.toFixed(2)}</span></div><div className="text-sm">Entry {p.last.toFixed(4)} · Target {p.target.toFixed(4)} · Stop {p.stop.toFixed(4)} · Qty @ A${capital}: {bd.qty}</div><div className="text-xs text-slate-300">Capital A${capital} · Buy Fee A${bd.buyFee.toFixed(2)} · Sell Fee A${bd.sellFee.toFixed(2)} · Total Fees A${bd.totalFees.toFixed(2)} · Effective Invested A${bd.invested.toFixed(2)} · Break-even {bd.breakeven?bd.breakeven.toFixed(4):'—'}</div><div className="flex gap-2"><button className="btn mt-1 px-3 py-1.5 rounded-lg bg-emerald-500 hover:bg-emerald-600" onClick={()=>toggle(p.symbol)}>{isOpen?'Cancel':'Mark as Purchased'}</button></div>{isOpen&&(<div className="row"><div className="flex items-center gap-2"><span className="muted text-xs">Amount to invest (AUD):</span><input type="number" min="50" step="1" className="glass px-3 py-1 rounded-md w-32 text-slate-100" value={curAmt} onChange={e=>setAmt(a=>({...a,[p.symbol]:Math.max(0,Number(e.target.value||0))}))}/><button className="btn px-3 py-1.5 rounded-lg bg-emerald-600 hover:bg-emerald-700" onClick={()=>confirm(p)}>Confirm Purchase</button></div><div className="text-xs text-slate-300 mt-1">Qty {bd2.qty} · Buy Fee A${bd2.buyFee.toFixed(2)} · Sell Fee A${bd2.sellFee.toFixed(2)} · Total Fees A${bd2.totalFees.toFixed(2)} · Effective Invested A${bd2.invested.toFixed(2)} · Break-even {bd2.breakeven?bd2.breakeven.toFixed(4):'—'}</div></div>)}</div>)})}</div><ErrorLine msg={aiErr}/>{ai&&(<div className="glass p-3 rounded-lg"><div className="text-sm">AI summary (default capital A${capital}):</div><div className="text-sm">Timeline: <span className="font-semibold">{ai.timelineDays??'—'} days</span></div><pre className="text-xs bg-black/30 p-3 rounded-lg overflow-auto mt-2">{JSON.stringify(ai,null,2)}</pre></div>)}</div>)}
function ManualCheck({capital}){const [symbol,setSymbol]=useState('PLS');const [entry,setEntry]=useState(2.31);const [date,setDate]=useState('');const [ai,setAi]=useState(null);const [err,setErr]=useState(null);const [loading,setLoading]=useState(false);
async function ask(){setErr(null);setAi(null);setLoading(true);try{const qs=new URLSearchParams({mode:'manual',symbol:symbol.toUpperCase(),entry,purchasedAt:date||new Date().toISOString(),capital});const r=await fetch(`/.netlify/functions/advice?`+qs.toString());const j=await r.json();if(j.error)throw new Error(j.error+(j.details?(' · '+j.details):''));setAi(j.advice)}catch(e){setErr(e.message)}finally{setLoading(false)}}
const bd=breakdown(capital,entry);
return(<div className="card p-5 md:p-6 space-y-3"><h2 className="text-lg font-semibold">Manual Check (any ASX code)</h2><div className="grid md:grid-cols-5 gap-3"><input className="glass px-3 py-2" value={symbol} onChange={e=>setSymbol(e.target.value)} placeholder="Symbol (e.g. PLS)"/><input type="number" step="0.0001" className="glass px-3 py-2" value={entry} onChange={e=>setEntry(Number(e.target.value))} placeholder="Entry price"/><input type="datetime-local" className="glass px-3 py-2" value={date} onChange={e=>setDate(e.target.value)} placeholder="Purchase date (optional)"/><button className="btn px-3 py-2 rounded-lg bg-sky-600 hover:bg-sky-700" onClick={ask} disabled={loading}>{loading?'Asking…':'Ask ChatGPT'}</button></div><div className="text-xs text-slate-300">Capital A${capital} · Qty {bd.qty} · Buy Fee A${bd.buyFee.toFixed(2)} · Sell Fee A${bd.sellFee.toFixed(2)} · Total Fees A${bd.totalFees.toFixed(2)} · Break-even {bd.breakeven?bd.breakeven.toFixed(4):'—'}</div><ErrorLine msg={err}/>{ai&&(<div className="glass p-3 rounded-lg"><div className="text-sm">Timeline: <span className="font-semibold">{ai.timelineDays??'—'} days</span></div><pre className="text-xs bg-black/30 p-3 rounded-lg overflow-auto mt-2">{JSON.stringify(ai,null,2)}</pre></div>)}</div>)}
function Holding({holding,onClear}){const [last,setLast]=useState(null);const [hi,setHi]=useState(null);const [err,setErr]=useState(null);const [ai,setAi]=useState(null);const [aiErr,setAiErr]=useState(null);const [loading,setLoading]=useState(false);const [aiLoading,setAiLoading]=useState(false);
async function refresh(){setErr(null);setLoading=true;try{const qs=new URLSearchParams({fn:'since',symbol:holding.symbol,from:holding.purchasedAt});const r=await fetch(`${API}?`+qs.toString());const j=await r.json();if(j.error)throw new Error(j.error);setLast(j.last);setHi(j.highSince)}catch(e){setErr(e.message);setLast(null);setHi(null)}finally{setLoading(false)}}
useEffect(()=>{refresh()},[holding.symbol,holding.purchasedAt]);
const entry=Number(holding.entry),qty=Number(holding.qty),capital=Number(holding.capital),buyFee=Number(holding.buyFee||feeFor(capital)),sellFee=Number(holding.sellFee||feeFor(capital));const baseTP=entry*1.08;const trail=(hi!=null)?hi*0.985:null;const suggested=trail!=null?Math.max(baseTP,trail):baseTP;const pnlGross=(last!=null)?(last-entry)*qty:null;const pnlNet=(pnlGross!=null)?pnlGross-(buyFee+sellFee):null;const breakeven=holding.breakeven??((capital+buyFee+sellFee)/qty);
async function askAI(){setAiErr(null);setAi(null);setAiLoading(true);try{const qs=new URLSearchParams({mode:'holding',symbol:holding.symbol,entry:holding.entry,purchasedAt:holding.purchasedAt,capital,fees:(buyFee+sellFee).toFixed(2)});const r=await fetch(`${AI}?`+qs.toString());const j=await r.json();if(j.error)throw new Error(j.error+(j.details?(' · '+j.details):''));setAi(j.advice)}catch(e){setAiErr(e.message)}finally{setAiLoading(false)}}
return(<div className="card p-5 md:p-6 space-y-3"><div className="flex items-center justify-between"><h2 className="text-lg font-semibold">Holding</h2><div className="flex gap-2"><span className="pill bg-white/10">Qty {qty}</span><button className="btn px-3 py-1.5 rounded-lg bg-slate-700 hover:bg-slate-600" onClick={refresh} disabled={loading}>{loading?'Loading…':'Refresh'}</button><button className="btn px-3 py-1.5 rounded-lg bg-sky-600 hover:bg-sky-700" onClick={askAI} disabled={aiLoading}>{aiLoading?'Asking…':'Ask ChatGPT (Hold/Sell?)'}</button><button className="btn px-3 py-1.5 rounded-lg bg-rose-600 hover:bg-rose-700" onClick={onClear}>Clear</button></div></div><div className="grid md:grid-cols-6 gap-3"><div className="glass px-3 py-2"><div className="muted text-sm">Symbol</div><div className="text-xl font-semibold">{holding.symbol}</div></div><div className="glass px-3 py-2"><div className="muted text-sm">Entry</div><div className="text-xl font-semibold">{entry.toFixed(4)}</div></div><div className="glass px-3 py-2"><div className="muted text-sm">Last</div><div className="text-xl font-semibold">{(last!=null)?Number(last).toFixed(4):'—'}</div></div><div className="glass px-3 py-2"><div className="muted text-sm">High since buy</div><div className="text-xl font-semibold">{(hi!=null)?Number(hi).toFixed(4):'—'}</div></div><div className="glass px-3 py-2"><div className="muted text-sm">Suggested Sell</div><div className="text-xl font-semibold">{Number(suggested).toFixed(4)}</div><div className="muted text-xs">max(+8%, trail 1.5%)</div></div><div className="glass px-3 py-2"><div className="muted text-sm">P/L (net est.)</div><div className={"text-xl font-semibold "+((pnlNet||0)>=0?'text-emerald-400':'text-rose-400')}>{(pnlNet!=null)?('A$'+pnlNet.toFixed(2)):'—'}</div></div></div><div className="text-xs text-slate-300">Capital A${capital} · Buy Fee A${buyFee.toFixed(2)} · Sell Fee A${sellFee.toFixed(2)} · Total Fees A${(buyFee+sellFee).toFixed(2)} · Break-even {breakeven?breakeven.toFixed(4):'—'}</div>{ai&&(<div className="glass p-3 rounded-lg"><div className="text-sm">AI timeline: <span className="font-semibold">{ai.timelineDays??'—'} days</span></div><pre className="text-xs bg-black/30 p-3 rounded-lg overflow-auto mt-2">{JSON.stringify(ai,null,2)}</pre></div>)}<ErrorLine msg={aiErr}/><ErrorLine msg={err}/></div>)}
function App(){const [capital,setCapital]=useLocal('capital',1000);const [holding,setHolding]=useLocal('holding',null);
function handlePurchase(p){const bd=breakdown(p.capital,p.last);const newHold={symbol:p.symbol,entry:Number(p.last),qty:bd.qty,capital:p.capital,buyFee:bd.buyFee,sellFee:bd.sellFee,breakeven:bd.breakeven,purchasedAt:new Date().toISOString()};setHolding(newHold);window.scrollTo({top:0,behavior:'smooth'})}
return(<div className="max-w-6xl mx-auto p-4 md:p-8 space-y-6"><Header capital={capital} setCapital={setCapital}/><Top3 onPurchase={handlePurchase} capital={capital}/><ManualCheck capital={capital}/>{holding?<Holding holding={holding} onClear={()=>setHolding(null)}/>:<p className="muted text-sm">No active holding. Pick one above and “Mark as Purchased”.</p>}<footer className="py-8 text-center text-slate-500 text-xs">Built for educational purposes. Not financial advice.</footer></div>)}
const root=ReactDOM.createRoot(document.getElementById('root'));root.render(<App/>);
</script></body></html>